<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Synapse - Medical Study Focus App</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0 }
        html { font-family: system-ui, -apple-system, sans-serif; background: #0f172a; color: #fff; height: 100% }
        body { height: 100%; overflow-x: hidden }
        #root { height: 100% }
        .app { min-height: 100vh; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%) }
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); border-top: 1px solid rgba(6, 182, 212, 0.2); display: flex; justify-content: space-around; padding: 8px 0; z-index: 50 }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 16px; background: none; border: none; color: #94a3b8; font-size: 10px; cursor: pointer; transition: all 0.2s }
        .nav-btn.active, .nav-btn:hover { color: #06b6d4 }
        .screen { padding: 20px; padding-bottom: 100px; max-width: 500px; margin: 0 auto }
        .header { text-align: center; padding: 40px 20px }
        .logo { font-size: 48px; margin-bottom: 16px }
        .title { font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #06b6d4, #22d3ee); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text }
        .subtitle { color: #94a3b8; margin-top: 8px; font-size: 14px }
        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(6, 182, 212, 0.2); border-radius: 16px; padding: 20px; margin-bottom: 16px }
        .card-title { font-size: 12px; color: #06b6d4; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px }
        .select { width: 100%; padding: 12px 16px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 12px; color: #fff; font-size: 16px; cursor: pointer }
        .select option { background: #1e293b; color: #fff }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s }
        .btn-primary { background: linear-gradient(135deg, #0891b2, #06b6d4); color: #fff }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(6, 182, 212, 0.3) }
        .timer-display { text-align: center; padding: 60px 20px }
        .timer-time { font-size: 80px; font-weight: 200; font-family: 'SF Mono', monospace; background: linear-gradient(135deg, #06b6d4, #22d3ee); -webkit-background-clip: text; -webkit-text-fill-color: transparent }
        .timer-label { color: #94a3b8; font-size: 14px; margin-top: 8px }
        .timer-controls { display: flex; gap: 12px; justify-content: center; margin-top: 32px }
        .timer-btn { width: 64px; height: 64px; border-radius: 50%; border: 2px solid rgba(6, 182, 212, 0.3); background: rgba(6, 182, 212, 0.1); color: #06b6d4; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s }
        .timer-btn:hover { background: rgba(6, 182, 212, 0.2); transform: scale(1.05) }
        .timer-btn.primary { background: linear-gradient(135deg, #0891b2, #06b6d4); border: none; color: #fff; width: 80px; height: 80px }
        .progress-ring { width: 280px; height: 280px; margin: 0 auto }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px }
        .stat-card { background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(6, 182, 212, 0.1); border-radius: 12px; padding: 16px; text-align: center }
        .stat-value { font-size: 24px; font-weight: 700; color: #06b6d4 }
        .stat-label { font-size: 11px; color: #64748b; margin-top: 4px; text-transform: uppercase }
        .exit-ticket { padding: 20px }
        .exit-ticket h2 { font-size: 24px; text-align: center; margin-bottom: 8px }
        .exit-ticket p { color: #94a3b8; text-align: center; margin-bottom: 24px }
        .exit-ticket textarea { width: 100%; min-height: 200px; padding: 16px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 12px; color: #fff; font-size: 16px; resize: vertical; font-family: inherit }
        .profile-header { text-align: center; padding: 40px 20px }
        .avatar { width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #0891b2, #06b6d4); display: flex; align-items: center; justify-content: center; font-size: 48px; margin: 0 auto 16px }
        .rank { font-size: 24px; font-weight: 700 }
        .rank-subtitle { color: #94a3b8; font-size: 14px }
        .progress-bar { height: 8px; background: rgba(6, 182, 212, 0.2); border-radius: 4px; overflow: hidden; margin: 16px 0 }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #0891b2, #06b6d4); border-radius: 4px; transition: width 0.3s }
        .badges { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 16px }
        .badge { padding: 8px 12px; background: rgba(6, 182, 212, 0.1); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 20px; font-size: 12px; color: #06b6d4 }
        .badge.locked { opacity: 0.4; color: #64748b; border-color: rgba(100, 116, 139, 0.3) }
        .heatmap { display: grid; grid-template-columns: repeat(12, 1fr); gap: 3px }
        .heatmap-cell { aspect-ratio: 1; border-radius: 2px; background: rgba(6, 182, 212, 0.1) }
        .heatmap-cell.l1 { background: rgba(6, 182, 212, 0.3) }
        .heatmap-cell.l2 { background: rgba(6, 182, 212, 0.5) }
        .heatmap-cell.l3 { background: rgba(6, 182, 212, 0.7) }
        .heatmap-cell.l4 { background: #06b6d4 }
        .vault-balance { text-align: center; padding: 32px; background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(34, 211, 238, 0.05)); border-radius: 16px; margin-bottom: 24px }
        .vault-amount { font-size: 48px; font-weight: 700; color: #06b6d4 }
        .vault-label { color: #94a3b8; font-size: 14px }
        .app-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px }
        .app-item { text-align: center; padding: 16px; background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(6, 182, 212, 0.1); border-radius: 12px; cursor: pointer; transition: all 0.2s }
        .app-item:hover { border-color: rgba(6, 182, 212, 0.3); transform: translateY(-2px) }
        .app-item.locked { opacity: 0.5 }
        .app-icon { font-size: 32px; margin-bottom: 8px }
        .app-name { font-size: 12px; color: #94a3b8 }
        .app-cost { font-size: 10px; color: #06b6d4; margin-top: 4px }
        .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid rgba(100, 116, 139, 0.1) }
        .volume-control { position: absolute; top: 60px; right: 20px; background: rgba(30, 41, 59, 0.95); border: 1px solid rgba(6, 182, 212, 0.2); border-radius: 12px; padding: 12px; display: flex; flex-direction: column; align-items: center; gap: 8px }
        .volume-slider { width: 100px; height: 4px; -webkit-appearance: none; background: rgba(6, 182, 212, 0.2); border-radius: 2px; outline: none }
        .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #06b6d4; border-radius: 50%; cursor: pointer }
        .alert { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #ef4444; color: #fff; padding: 12px 24px; border-radius: 12px; font-size: 14px; z-index: 100; animation: slideIn 0.3s }
        .alert.success { background: #10b981 }
        .alert.warning { background: #f59e0b }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-50%) translateY(-20px) } to { opacity: 1; transform: translateX(-50%) translateY(0) } }
        @keyframes pulse { 0%, 100% { opacity: 1 } 50% { opacity: 0.5 } }
        .pulsing { animation: pulse 2s infinite }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const SUBJECTS = [
            { id: 'cardio', name: 'Cardiology', icon: '‚ù§Ô∏è', keywords: ['heart', 'cardiac', 'coronary', 'myocardial', 'arrhythmia', 'murmur', 'valve'] },
            { id: 'neuro', name: 'Neurology', icon: 'üß†', keywords: ['brain', 'neuron', 'synapse', 'cortex', 'cerebral', 'spinal', 'nerve'] },
            { id: 'renal', name: 'Renal', icon: 'ü´ò', keywords: ['kidney', 'nephron', 'glomerular', 'filtration', 'tubule', 'urine'] },
            { id: 'gi', name: 'GI', icon: 'ü´Å', keywords: ['stomach', 'intestine', 'liver', 'pancreas', 'digestion', 'enzyme'] },
            { id: 'pulm', name: 'Pulmonology', icon: 'ü´Å', keywords: ['lung', 'respiratory', 'bronchi', 'alveoli', 'oxygen'] },
            { id: 'pharm', name: 'Pharmacology', icon: 'üíä', keywords: ['drug', 'receptor', 'agonist', 'antagonist', 'dose'] },
            { id: 'micro', name: 'Microbiology', icon: 'ü¶†', keywords: ['bacteria', 'virus', 'infection', 'antibiotic'] },
            { id: 'biochem', name: 'Biochem', icon: 'üß¨', keywords: ['enzyme', 'protein', 'metabolism', 'atp'] },
            { id: 'immuno', name: 'Immunology', icon: 'üõ°Ô∏è', keywords: ['antibody', 'antigen', 'lymphocyte', 'cytokine'] },
            { id: 'anatomy', name: 'Anatomy', icon: 'ü¶¥', keywords: ['bone', 'muscle', 'organ', 'tissue'] },
            { id: 'path', name: 'Pathology', icon: 'üî¨', keywords: ['disease', 'lesion', 'neoplasm', 'inflammation'] },
            { id: 'anki', name: 'Anki', icon: 'üìö', keywords: ['review', 'card', 'recall'] }
        ];

        const TIMER_PRESETS = [
            { id: 'standard', name: 'Standard', work: 25, break: 5 },
            { id: 'block', name: 'Block Exam', work: 60, break: 10 },
            { id: 'anki', name: 'Anki', work: 10, break: 2 },
            { id: 'deep', name: 'Deep Work', work: 50, break: 10 },
            { id: 'marathon', name: 'Marathon', work: 90, break: 20 }
        ];

        const RANKS = [
            { name: 'Pre-med', minHours: 0, icon: 'üìñ' },
            { name: 'M1', minHours: 10, icon: 'ü©∫' },
            { name: 'M2', minHours: 25, icon: 'üìã' },
            { name: 'Clerk', minHours: 50, icon: 'üë®‚Äç‚öïÔ∏è' },
            { name: 'Intern', minHours: 100, icon: 'üíâ' },
            { name: 'Resident', minHours: 200, icon: 'üè•' },
            { name: 'Fellow', minHours: 350, icon: 'üéì' },
            { name: 'Attending', minHours: 500, icon: '‚≠ê' },
            { name: 'Chair', minHours: 1000, icon: 'üëë' }
        ];

        const BADGES = [
            { id: 'first', name: 'First Steps', icon: 'üéØ', check: s => s.totalSessions >= 1 },
            { id: 'week', name: 'Week Warrior', icon: 'üî•', check: s => s.currentStreak >= 7 },
            { id: 'century', name: 'Centurion', icon: 'üíØ', check: s => s.totalSessions >= 100 },
            { id: 'night', name: 'Night Owl', icon: 'ü¶â', check: s => s.nightOwl }
        ];

        const VAULT_APPS = [
            { id: 'instagram', name: 'Instagram', icon: 'üì∑', cost: 15 },
            { id: 'netflix', name: 'Netflix', icon: 'üé¨', cost: 30 },
            { id: 'youtube', name: 'YouTube', icon: '‚ñ∂Ô∏è', cost: 20 },
            { id: 'twitter', name: 'Twitter', icon: 'üê¶', cost: 10 }
        ];

        let state = {
            screen: 'home',
            selectedSubject: 'cardio',
            selectedPreset: 'standard',
            timerState: 'idle',
            timeRemaining: 1500,
            isBreak: false,
            exitTicketText: '',
            audioEnvironment: 'silent',
            volume: 0.5,
            showVolume: false,
            strictnessLevel: 'intern',
            stats: loadStats(),
            sessions: loadSessions(),
            alert: null
        };

        function loadStats() {
            try { return JSON.parse(localStorage.getItem('synapse_stats')) || { totalHours: 0, totalSessions: 0, currentStreak: 0, longestStreak: 0, vaultBalance: 0, perfectExits: 0, subjectHours: {} }; }
            catch { return { totalHours: 0, totalSessions: 0, currentStreak: 0, longestStreak: 0, vaultBalance: 0, subjectHours: {} }; }
        }

        function loadSessions() {
            try { return JSON.parse(localStorage.getItem('synapse_sessions')) || []; } catch { return []; }
        }

        function saveData() {
            localStorage.setItem('synapse_stats', JSON.stringify(state.stats));
            localStorage.setItem('synapse_sessions', JSON.stringify(state.sessions));
        }

        function showAlert(message, type = 'error') {
            state.alert = { message, type };
            render();
            setTimeout(() => { state.alert = null; render(); }, 3000);
        }

        function getPreset() { return TIMER_PRESETS.find(p => p.id === state.selectedPreset) || TIMER_PRESETS[0]; }
        function getSubject() { return SUBJECTS.find(s => s.id === state.selectedSubject) || SUBJECTS[0]; }
        function formatTime(s) { return `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }

        let timerInterval = null;
        let audioContext = null;

        function startTimer() {
            if (state.timerState === 'running') return;
            if (state.timerState === 'idle') {
                state.timeRemaining = getPreset().work * 60;
                state.isBreak = false;
            }
            state.timerState = 'running';
            // Placeholder for audio start
            timerInterval = setInterval(() => {
                state.timeRemaining--;
                if (state.timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    if (state.isBreak) {
                        state.timerState = 'idle';
                        state.timeRemaining = getPreset().work * 60;
                        state.isBreak = false;
                        showAlert('Break over!', 'success');
                    } else {
                        state.timerState = 'exitTicket';
                        state.exitTicketText = '';
                    }
                }
                render();
            }, 1000);
            render();
        }

        function pauseTimer() {
            if (state.strictnessLevel !== 'intern') return showAlert('Cannot pause!', 'error');
            clearInterval(timerInterval);
            state.timerState = 'paused';
            render();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            state.timerState = 'idle';
            state.timeRemaining = getPreset().work * 60;
            state.isBreak = false;
            render();
        }

        function validateExitTicket() {
            const text = state.exitTicketText.toLowerCase();
            const bullets = text.split('\n').filter(l => l.trim().length > 0);
            if (bullets.length < 3) return showAlert('Need 3+ bullets', 'error');
            
            const subject = getSubject();
            const keywords = subject.keywords.filter(kw => text.includes(kw.toLowerCase()));
            
            if (keywords.length >= 2 || state.strictnessLevel === 'intern') {
                const preset = getPreset();
                const hours = preset.work / 60;
                state.stats.totalHours += hours;
                state.stats.totalSessions++;
                state.stats.vaultBalance += Math.floor(preset.work / 6);
                state.stats.currentStreak++;
                if(!state.stats.subjectHours[state.selectedSubject]) state.stats.subjectHours[state.selectedSubject] = 0;
                state.stats.subjectHours[state.selectedSubject] += hours;
                
                state.sessions.unshift({ id: Date.now(), subject: state.selectedSubject, duration: preset.work, date: new Date().toISOString() });
                saveData();
                
                state.timerState = 'break';
                state.timeRemaining = preset.break * 60;
                state.isBreak = true;
                startTimer();
                showAlert(`Session Complete! +${Math.floor(preset.work / 6)} vault min`, 'success');
            } else {
                showAlert('Validation failed. Use more keywords.', 'error');
            }
        }

        function render() {
            const root = document.getElementById('root');
            root.innerHTML = `<div class="app">${state.alert ? `<div class="alert ${state.alert.type}">${state.alert.message}</div>` : ''}${renderScreen()}${renderNav()}</div>`;
            attachEvents();
        }

        function renderNav() {
            const items = [
                { id: 'home', icon: 'üè†', label: 'Home' },
                { id: 'timer', icon: '‚è±Ô∏è', label: 'Timer' },
                { id: 'dashboard', icon: 'üìä', label: 'Chart' },
                { id: 'profile', icon: 'üë§', label: 'Profile' },
                { id: 'vault', icon: 'üéÅ', label: 'Vault' }
            ];
            return `<nav class="nav">${items.map(i => `<button class="nav-btn ${state.screen === i.id ? 'active' : ''}" data-screen="${i.id}"><span style="font-size:20px;">${i.icon}</span><span>${i.label}</span></button>`).join('')}</nav>`;
        }

        function renderScreen() {
            if (state.screen === 'home') return renderHome();
            if (state.screen === 'timer') return renderTimer();
            if (state.screen === 'dashboard') return renderDashboard();
            if (state.screen === 'profile') return renderProfile();
            if (state.screen === 'vault') return renderVault();
            return renderHome();
        }

        function renderHome() {
            return `<div class="screen"><div class="header"><div class="logo">üß†</div><h1 class="title">SYNAPSE</h1><p class="subtitle">Proof-of-Work Focus Tool</p></div>
            <div class="card"><div class="card-title">Subject</div><select class="select" id="subjectSelect">${SUBJECTS.map(s => `<option value="${s.id}" ${s.id === state.selectedSubject ? 'selected' : ''}>${s.icon} ${s.name}</option>`).join('')}</select></div>
            <div class="card"><div class="card-title">Preset</div><select class="select" id="presetSelect">${TIMER_PRESETS.map(p => `<option value="${p.id}" ${p.id === state.selectedPreset ? 'selected' : ''}>${p.name} (${p.work}m)</option>`).join('')}</select></div>
            <button class="btn btn-primary" id="beginBtn">‚ö° Begin Shift</button></div>`;
        }

        function renderTimer() {
            if (state.timerState === 'exitTicket') return renderExitTicket();
            const total = state.isBreak ? getPreset().break * 60 : getPreset().work * 60;
            const progress = ((total - state.timeRemaining) / total) * 100;
            return `<div class="screen"><div class="timer-display"><div class="timer-time ${state.timerState==='running'?'pulsing':''}">${formatTime(state.timeRemaining)}</div><div class="timer-label">${state.isBreak?'Break':'Focus'}</div></div>
            <div class="timer-controls"><button class="timer-btn" id="resetBtn">‚Ü∫</button>${state.timerState === 'running' ? `<button class="timer-btn primary" id="pauseBtn">‚è∏</button>` : `<button class="timer-btn primary" id="playBtn">‚ñ∂</button>`}</div></div>`;
        }

        function renderExitTicket() {
            return `<div class="exit-ticket"><h2>üéì Exit Ticket</h2><p>3 bullet points about ${getSubject().name}</p>
            <div class="card"><textarea id="exitTextarea" placeholder="‚Ä¢ Learned...">${state.exitTicketText}</textarea></div>
            <button class="btn btn-primary" id="submitExitBtn">Submit</button></div>`;
        }

        function renderDashboard() {
            const data = state.sessions.slice(0, 5);
            return `<div class="screen"><h2 style="margin-bottom:20px;">üìä Clinical Chart</h2>
            <div class="card"><div class="card-title">Recent</div>${data.length ? data.map(s => `<div style="padding:8px;border-bottom:1px solid #334;">${s.subject} - ${s.duration}m</div>`).join('') : '<p style="text-align:center;color:#666">No sessions</p>'}</div>
            <div class="card"><div class="card-title">Heatmap</div><div class="heatmap">${Array(60).fill('').map(() => `<div class="heatmap-cell ${Math.random() > 0.7 ? 'l4' : 'l1'}"></div>`).join('')}</div></div></div>`;
        }

        function renderProfile() {
             return `<div class="screen"><div class="profile-header"><div class="avatar">üë§</div><div class="rank">Student</div><div class="rank-subtitle">${state.stats.totalHours.toFixed(1)} hrs</div></div>
             <div class="card"><div class="card-title">Stats</div><div class="stats-grid"><div class="stat-card"><div class="stat-value">${state.stats.totalSessions}</div><div class="stat-label">Sessions</div></div><div class="stat-card"><div class="stat-value">${state.stats.currentStreak}</div><div class="stat-label">Streak</div></div></div></div></div>`;
        }

        function renderVault() {
            return `<div class="screen"><div class="vault-balance"><div class="vault-amount">${state.stats.vaultBalance}</div><div class="vault-label">Minutes</div></div>
            <div class="card"><div class="app-grid">${VAULT_APPS.map(a => `<div class="app-item ${state.stats.vaultBalance < a.cost ? 'locked' : ''}" onclick="unlockApp('${a.name}', ${a.cost})"><div class="app-icon">${a.icon}</div><div class="app-name">${a.name}</div><div class="app-cost">${a.cost}m</div></div>`).join('')}</div></div></div>`;
        }

        function unlockApp(name, cost) {
            if(state.stats.vaultBalance >= cost) {
                state.stats.vaultBalance -= cost;
                saveData();
                showAlert(`Unlocked ${name}`, 'success');
            } else showAlert('Not enough minutes', 'error');
        }

        function attachEvents() {
            document.querySelectorAll('.nav-btn').forEach(b => b.onclick = () => { state.screen = b.dataset.screen; render(); });
            const beginBtn = document.getElementById('beginBtn');
            if(beginBtn) beginBtn.onclick = () => { state.screen = 'timer'; state.timeRemaining = getPreset().work*60; render(); };
            
            const playBtn = document.getElementById('playBtn'); if(playBtn) playBtn.onclick = startTimer;
            const pauseBtn = document.getElementById('pauseBtn'); if(pauseBtn) pauseBtn.onclick = pauseTimer;
            const resetBtn = document.getElementById('resetBtn'); if(resetBtn) resetBtn.onclick = resetTimer;
            
            const submitBtn = document.getElementById('submitExitBtn'); if(submitBtn) submitBtn.onclick = validateExitTicket;
            const exitText = document.getElementById('exitTextarea'); if(exitText) exitText.oninput = (e) => state.exitTicketText = e.target.value;
            
            const subSel = document.getElementById('subjectSelect'); if(subSel) subSel.onchange = (e) => state.selectedSubject = e.target.value;
            const preSel = document.getElementById('presetSelect'); if(preSel) preSel.onchange = (e) => { state.selectedPreset = e.target.value; };
        }

        // Initialize
        render();
    </script>
</body>
</html>
